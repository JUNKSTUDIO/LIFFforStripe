<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LIFF Stripe Checkout</title>
</head>

<body>
  <script src="https://js.stripe.com/v3"></script>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/kota-imai/liff-plugin-stripe-checkout-button@main/v1/plugin.min.js"></script>

  <button
    style="background-color:#6772E5;color:#FFF;padding:8px 12px;border:0;border-radius:4px;font-size:1em;cursor:pointer"
    id="checkout-button" type="button">
    Stripeで支払う
  </button>

  <div id="error-message"></div>

  <script>
    liff.use(new StripeCheckoutButtonPlugin());
    liff.init({
      liffId: '1660815275-DZgqJnlP'// LIFF ID を入れる。
    })
      .catch((err) => {
        console.log(err);
      });
    liff.ready.then(() => {
      if (!liff.isLoggedIn()) {
        liff.login();
      }
      const idToken = liff.getDecodedIDToken();
      const userId = idToken.sub;
      const email = idToken.email;

      const button = document.getElementById('checkout-button');
      liff.$stripeCheckoutButton.init({
        apiKey: 'pk_test_51MqQpzHQDAkHoIdseOdG4Gj9mEwzWQjoOHLwQoSJuiUvBG49PMrpCskGBJk2cfG1tO0Un5OrP4zsTcpYYTDyzFEW00rqlUKk8I' // Stripeの公開可能キー(STRIPE_PUBLIC_KEY)
      });
      liff.$stripeCheckoutButton.bind(button, {
        priceId: 'price_1MrOZ2HQDAkHoIdspqUqxFo3', // Stripeの商品の価格ID<YOUR_PRICE_ID>
        quantity: 1,
        successUrl: `${location.origin}/success?id={CHECKOUT_SESSION_ID}`,
        cancelUrl: `${location.origin}/cancel`,
        clientReferenceId: userId,  // LINEのユーザーID
        customerEmail: email, // LINEから取得したメールアドレス
      });
    });
  </script>
</body>

</html>
